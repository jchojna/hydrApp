!function(c){var t={};function e(n){if(t[n])return t[n].exports;var l=t[n]={i:n,l:!1,exports:{}};return c[n].call(l.exports,l,l.exports,e),l.l=!0,l.exports}e.m=c,e.c=t,e.d=function(c,t,n){e.o(c,t)||Object.defineProperty(c,t,{enumerable:!0,get:n})},e.r=function(c){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})},e.t=function(c,t){if(1&t&&(c=e(c)),8&t)return c;if(4&t&&"object"==typeof c&&c&&c.__esModule)return c;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:c}),2&t&&"string"!=typeof c)for(var l in c)e.d(n,l,function(t){return c[t]}.bind(null,l));return n},e.n=function(c){var t=c&&c.__esModule?function(){return c.default}:function(){return c};return e.d(t,"a",t),t},e.o=function(c,t){return Object.prototype.hasOwnProperty.call(c,t)},e.p="",e(e.s=0)}([function(module,exports,__webpack_require__){"use strict";eval("\r\n\r\n//////////////////////////////////////////////////////////////// SERVICE WORKER\r\nif ('serviceWorker' in navigator) {\r\n  window.addEventListener('load', function() {\r\n    navigator.serviceWorker.register('serviceworker.js').then(function(registration) {\r\n      // Registration was successful\r\n      //console.log('ServiceWorker registration successful with scope: ', registration.scope);\r\n    }, function(err) {\r\n      // registration failed :(\r\n      console.log('ServiceWorker registration failed: ', err);\r\n    });\r\n  });\r\n}\r\n///////////////////////////////////////////////////////////////////// FUNCTIONS\r\n/////////////////////////////////////////////////////// CREATE HYDRAPP DATE KEY\r\nconst setDateKey = (obj) => {\r\n  const prefix = 'hydrApp-';\r\n  const date = obj.toISOString().slice(0,10);\r\n  return prefix.concat(date);\r\n}\r\n//////////////////////////////////////// CREATE KEY VALUE PAIR IN LOCAL STORAGE\r\nconst setNewKeyValue = (key, value) => {\r\n  if ( !localStorage.getItem(key) ) {\r\n    localStorage.setItem(key, value);\r\n  };\r\n}\r\n//////////////////////////////////// CREATE ARRAY OF HYDRAPP LOCAL STORAGE KEYS\r\nconst getHydrappKeys = () => {\r\n  const regex = /hydrApp-/;\r\n  return Object\r\n  .keys(localStorage)\r\n  .filter(key => regex.test(key))\r\n  .sort()\r\n  .reverse();\r\n}\r\n/////////////////////////////////////////////////////////////////// GET DATE ID\r\nconst getDateID = (date) => {\r\n  return date\r\n    .replace('hydrApp-','')\r\n    .split('-')\r\n    .reverse()\r\n    .join('');\r\n}\r\n///////////////////////////////////////////////////////////// GET OFFSETED DATE\r\nconst getOffsetedDate = () => {\r\n  const timeZoneOffset = (new Date()).getTimezoneOffset() * 60000;\r\n  return (new Date(Date.now() - timeZoneOffset));\r\n}\r\n/////////////////////////////////////////////////////////////////// SET COUNTER\r\nconst setCounter = () => {\r\n  const offsetedDate = getOffsetedDate();\r\n  let dateKey = setDateKey(offsetedDate);\r\n  console.log(`newest key: ${dateKey}`);\r\n\r\n  setNewKeyValue(dateKey, 0);\r\n\r\n  const hydrappKeys = getHydrappKeys();\r\n  const oldestKey = hydrappKeys[hydrappKeys.length-1];\r\n  console.log(`oldest key: ${oldestKey}`);\r\n\r\n  // autocomplete missing keys in localstorage\r\n  if ( hydrappKeys.length > 1 ) {\r\n    let limit = 0; // for tests to avoid loop error\r\n\r\n    while (setDateKey(offsetedDate) !== oldestKey && limit < 50) {\r\n      offsetedDate.setDate( offsetedDate.getDate() - 1 );\r\n      const prevDateKey = setDateKey(offsetedDate);\r\n      setNewKeyValue(prevDateKey, 0);\r\n      limit++;\r\n    }\r\n  }\r\n  counter.innerHTML = localStorage.getItem(dateKey);\r\n}\r\n/////////////////////////////////////////////////////////////////// SET ARCHIVE\r\nconst setArchive = () => {\r\n  const hydrappKeys = getHydrappKeys();\r\n\r\n  if (hydrappKeys.length === 1) {\r\n    archiveList.innerHTML += `\r\n      <li class=\"archive__item archive__item--empty\">No history yet...</li>\r\n      `;\r\n  } else {\r\n    for (let i = 1; i < hydrappKeys.length; i++) {\r\n      const key = hydrappKeys[i];\r\n      const value = localStorage.getItem(key);\r\n      const date = key\r\n        .replace('hydrApp-','')\r\n        .split('-')\r\n        .reverse()\r\n        .join(' ');\r\n      const dateID = date.replace(/\\s/g,'');\r\n      \r\n      let indicators = \"\";\r\n      for (let i = 0; i < 8; i++) {\r\n        indicators += `\r\n        <svg class=\"indicator__svg indicator__svg--emo-${i+1} indicator__svg--js-${i}\">\r\n          <use href=\"assets/svg/icons.svg#emoticon-${i}\"></use>\r\n        </svg>`\r\n      }\r\n\r\n      archiveList.innerHTML += `\r\n      <li class=\"archive__item archive__item--js ${key}\">\r\n        <p class=\"archive__date\">${date}</p>\r\n        <p class=\"archive__value archive__value--js\">\r\n          ${value}\r\n        </p>\r\n        <div class=\"edition edition--js\">\r\n          <button class=\"button edition__button edition__button--visible edition__button--edit edition__button--js-edit\">\r\n            <svg class=\"edition__svg edition__svg--edit\">\r\n              <use href=\"assets/svg/icons.svg#edit-mode\"></use>\r\n            </svg>\r\n          </button>\r\n          <button class=\"button edition__button edition__button--decrease edition__button--js-decrease\">\r\n            <svg class=\"edition__svg edition__svg--decrease\">\r\n              <use href=\"assets/svg/icons.svg#left-arrow\"></use>\r\n            </svg>\r\n          </button>\r\n          <button class=\"button edition__button edition__button--increase edition__button--js-increase\">\r\n            <svg class=\"edition__svg edition__svg--increase\">\r\n              <use href=\"assets/svg/icons.svg#right-arrow\"></use>\r\n            </svg>\r\n          </button>\r\n          <button class=\"button edition__button edition__button--cancel edition__button--js-cancel\">\r\n            <svg class=\"edition__svg edition__svg--cancel\">\r\n              <use href=\"assets/svg/icons.svg#back-arrow\"></use>\r\n            </svg>\r\n          </button>\r\n          <button class=\"button edition__button edition__button--save edition__button--js-save\">\r\n            <svg class=\"edition__svg edition__svg--save\">\r\n              <use href=\"assets/svg/icons.svg#save-icon\"></use>\r\n            </svg>\r\n          </button>\r\n        </div>\r\n        <div class=\"indicator indicator--js-${dateID}\">\r\n          ${indicators}\r\n        </div>\r\n      </li>`\r\n      setIndicators(dateID, value);\r\n    }\r\n  }\r\n}\r\n//////////////////////////////////////////////////////////////// SET INDICATORS\r\nconst setIndicators = (id, value) => {\r\n\r\n  value > 7 ? value = 7 : false;\r\n\r\n  const indicators = document.querySelector(`.indicator--js-${id}`).children;\r\n  const indicator = document.querySelector(`.indicator--js-${id} .indicator__svg--js-${value}`);\r\n  \r\n  for (const indicator of indicators) {\r\n    indicator.classList.contains('indicator__svg--visible')\r\n    ? indicator.classList.remove('indicator__svg--visible')\r\n    : false\r\n  }\r\n  indicator.classList.add('indicator__svg--visible');\r\n}\r\n//////////////////////////////////////////////////////////////// UPDATE COUNTER\r\nconst updateCounter = (e) => {\r\n  const offsetedDate = getOffsetedDate();\r\n  const key = setDateKey(offsetedDate);\r\n  const value = parseInt(localStorage.getItem(key));\r\n  let newValue;\r\n\r\n  if (e.target === addGlass) {\r\n    value < counterMaxValue ? newValue = value + 1 : newValue = counterMaxValue;\r\n  } else if (e.target === removeGlass) {\r\n    value > 0 ? newValue = value - 1 : newValue = 0;\r\n  }\r\n\r\n  localStorage.setItem(key, newValue);\r\n  counter.innerHTML = newValue;\r\n  \r\n  // updating archive newest entry indicator\r\n  const dateID = offsetedDate\r\n    .toISOString()\r\n    .slice(0,10)\r\n    .split('-')\r\n    .reverse()\r\n    .join('');\r\n}\r\n//////////////////////////////////////////////////////////////// TOGGLE ARCHIVE\r\nconst toggleArchive = () => {\r\n  archive.classList.toggle('archive--visible');\r\n\r\n  loadMoreButton.classList.remove('archive__button--hidden');\r\n  for (const archiveItem of archiveItems) {\r\n    archiveItem.classList.remove('archive__item--visible');\r\n  }\r\n\r\n  ///////////////////////////////////////////////// LOAD MORE << TOGGLE ARCHIVE\r\n  const loadMore = () => {\r\n    \r\n    // const allEqual = itemsHeights.every( elem => elem === itemsHeights[0]);\r\n    // const itemsHeights = itemsArray.map(elem => elem.offsetHeight);\r\n    \r\n    const itemArray = [...archiveItems];\r\n    const archiveListHeight = archiveList.clientHeight;\r\n\r\n    let firstIndexToLoad = itemArray.findIndex(elem => !elem.classList.contains('archive__item--visible'));\r\n    let heights = 0;\r\n    let scrollOffset = archiveList.scrollTop;\r\n    while (true) {\r\n      \r\n      if (firstIndexToLoad < itemArray.length) {\r\n        \r\n        const item = itemArray[firstIndexToLoad];\r\n        item.classList.add('archive__item--visible');\r\n        heights += item.offsetHeight;\r\n        scrollOffset += item.offsetHeight;\r\n        \r\n        if (heights <= archiveListHeight - item.offsetHeight) {\r\n          firstIndexToLoad++;\r\n        } else {\r\n          archiveList.scrollTop = scrollOffset;\r\n          return false;\r\n        }\r\n\r\n      } else {\r\n        archiveList.scrollTop = scrollOffset;\r\n        loadMoreButton.classList.add('archive__button--hidden');\r\n        loadMoreButton.removeEventListener('click', loadMore);\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n  //////////////////////////////////////////// FUNCTION CALLS << TOGGLE ARCHIVE\r\n  if (archive.classList.contains('archive--visible')) {\r\n    loadMore();\r\n    loadMoreButton.addEventListener('click', loadMore);\r\n  } else {\r\n    loadMoreButton.removeEventListener('click', loadMore);\r\n  }\r\n  /////////////////////////////////////////// EVENT LISTENERS << TOGGLE ARCHIVE\r\n}\r\n///////////////////////////////////////////////////////// END OF TOGGLE ARCHIVE\r\n///////////////////////////////////////////////////////////////////////////////\r\n////////////////////////////////////////////////////////////// HANDLE ITEM EDIT\r\nconst handleItemEdit = (e) => {\r\n  const itemIndex = e.target.index;\r\n  const archiveItem = archiveItems[itemIndex];\r\n  const editButton = editButtons[itemIndex];\r\n  const editSection = editSections[itemIndex];\r\n  const decreaseButton = decreaseButtons[itemIndex];\r\n  const increaseButton = increaseButtons[itemIndex];\r\n  const cancelButton = cancelButtons[itemIndex];\r\n  const saveButton = saveButtons[itemIndex];\r\n  const archiveValue = archiveValues[itemIndex];\r\n  const lastValue = archiveValue.textContent;\r\n  const itemClassName = e.target.parentElement.parentElement.className;\r\n\r\n  const hydrAppKey = itemClassName\r\n    .split(' ')\r\n    .filter(key => /hydrApp/.test(key))\r\n    .toString();\r\n  const dateID = getDateID(hydrAppKey);\r\n  ///////////////////////////////////// TOGGLE ITEM DISPLAY << HANDLE ITEM EDIT\r\n  const toggleItemDisplay = () => {\r\n    archive.classList.toggle('archive--on-top');\r\n    archiveItem.classList.toggle('archive__item--on-top');\r\n    pageOverlay.classList.toggle('archive__overlay--visible');\r\n    \r\n    for (const editButton of editSection.children) {\r\n      editButton.classList.toggle('edition__button--visible');\r\n    }\r\n    editSection.classList.toggle('edition--visible');\r\n  }\r\n  ////////////////////////////////////////// EXIT EDIT MODE << HANDLE ITEM EDIT\r\n  const exitEditMode = () => {\r\n    toggleItemDisplay();\r\n    const lastValue = localStorage.getItem(hydrAppKey);\r\n    archiveValue.textContent = lastValue;\r\n    setIndicators(dateID, lastValue);\r\n\r\n    archive.removeEventListener('click', handleEdition);\r\n    archive.removeEventListener('keydown', handleEdition);\r\n  }\r\n  ////////////////////////////////////////// HANDLE EDITION << HANDLE ITEM EDIT\r\n  const handleEdition = (e) => {\r\n    const self = e.keyCode || e.target;\r\n    let value = parseInt(archiveValue.textContent);\r\n\r\n    switch (self) {\r\n\r\n      case 37:\r\n      case decreaseButton:\r\n        e.preventDefault();\r\n        value > 0 ? value-- : false;\r\n        archiveValue.textContent = value;\r\n        setIndicators(dateID, value);\r\n      break;\r\n      \r\n      case 39:\r\n      case increaseButton:\r\n        e.preventDefault();\r\n        value < counterMaxValue ? value++ : false;\r\n        archiveValue.textContent = value;\r\n        setIndicators(dateID, value);\r\n      break;\r\n\r\n      case 27:\r\n      case pageOverlay:\r\n      case cancelButton:\r\n        e.preventDefault();\r\n        exitEditMode();\r\n      break;\r\n\r\n      case 13:\r\n      case saveButton:\r\n        e.preventDefault();\r\n        localStorage.setItem(hydrAppKey, parseInt(archiveValue.textContent));\r\n        exitEditMode();\r\n      break;\r\n    }\r\n  }\r\n  ////////////////////////////////////////// FUNCTION CALLS << HANDLE ITEM EDIT\r\n  toggleItemDisplay();\r\n  archive.addEventListener('click', handleEdition);\r\n  archive.addEventListener('keydown', handleEdition);\r\n} ///////////////////////////////////////////////////// END OF HANDLE ITEM EDIT\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n///////////////////////////////////////////////////////////////////// VARIABLES\r\nconst addGlass = document.querySelector('.app__button--js-add');\r\nconst removeGlass = document.querySelector('.app__button--js-remove');\r\nconst counter = document.querySelector('.glass__counter--js');\r\nconst archive = document.querySelector('.archive--js');\r\nconst pageOverlay = document.querySelector('.archive__overlay--js');\r\nconst archiveList = document.querySelector('.archive__list--js');\r\nconst archiveButton = document.querySelector('.navigation__button--js-archive');\r\nconst loadMoreButton = document.querySelector('.archive__button--js-load-more');\r\n\r\nconst counterMaxValue = 100;\r\n\r\nconst baseClassname = \"indicator__section indicator__section--js\";\r\nconst lowLevelClassname = `${baseClassname} indicator__section--low`;\r\nconst mediumLevelClassname = `${baseClassname} indicator__section--medium`;\r\nconst highLevelClassname = `${baseClassname} indicator__section--high`;\r\n//////////////////////////////////////////////////////// INITIAL FUNCTION CALLS\r\nsetCounter();\r\nsetArchive();\r\n///////////////////////////////////////////////////////////////////// VARIABLES\r\nconst archiveItems = document.querySelectorAll('.archive__item--js');\r\nconst editButtons = document.querySelectorAll('.edition__button--js-edit');\r\nconst editSections = document.querySelectorAll('.edition--js');\r\nconst decreaseButtons = document.querySelectorAll('.edition__button--js-decrease');\r\nconst increaseButtons = document.querySelectorAll('.edition__button--js-increase');\r\nconst cancelButtons = document.querySelectorAll('.edition__button--js-cancel');\r\nconst saveButtons = document.querySelectorAll('.edition__button--js-save');\r\nconst archiveValues = document.querySelectorAll('.archive__value--js');\r\n//////////////////////////////////////////////////////////////// FUNCTION CALLS\r\n/////////////////////////////////////////////////////////////// EVENT LISTENERS\r\naddGlass.addEventListener('click', updateCounter);\r\nremoveGlass.addEventListener('click', updateCounter);\r\narchiveButton.addEventListener('click', toggleArchive);\r\n\r\nfor (let i = 0; i < editButtons.length; i++) {\r\n  const editButton = editButtons[i];\r\n  editButton.index = i;\r\n  editButton.addEventListener('click', handleItemEdit);\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvanMvbWFpbi5qcz85MjkxIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixRQUFROztBQUVyQzs7QUFFQTtBQUNBO0FBQ0EsNkJBQTZCLFVBQVU7O0FBRXZDO0FBQ0E7QUFDQSxrQkFBa0I7O0FBRWxCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxtQkFBbUIsd0JBQXdCO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxxQkFBcUIsT0FBTztBQUM1QjtBQUNBLHlEQUF5RCxJQUFJLHNCQUFzQixFQUFFO0FBQ3JGLHFEQUFxRCxFQUFFO0FBQ3ZEO0FBQ0E7O0FBRUE7QUFDQSxtREFBbUQsSUFBSTtBQUN2RCxtQ0FBbUMsS0FBSztBQUN4QztBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QyxPQUFPO0FBQ3JELFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBLDhEQUE4RCxHQUFHO0FBQ2pFLDZEQUE2RCxHQUFHLHVCQUF1QixNQUFNOztBQUU3RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSw2QkFBNkIsY0FBYztBQUMzQyxnQ0FBZ0MsY0FBYztBQUM5Qyw4QkFBOEIsY0FBYztBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGVBQWUsd0JBQXdCO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6IjAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuXHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8gU0VSVklDRSBXT1JLRVJcclxuaWYgKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcclxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJ3NlcnZpY2V3b3JrZXIuanMnKS50aGVuKGZ1bmN0aW9uKHJlZ2lzdHJhdGlvbikge1xyXG4gICAgICAvLyBSZWdpc3RyYXRpb24gd2FzIHN1Y2Nlc3NmdWxcclxuICAgICAgLy9jb25zb2xlLmxvZygnU2VydmljZVdvcmtlciByZWdpc3RyYXRpb24gc3VjY2Vzc2Z1bCB3aXRoIHNjb3BlOiAnLCByZWdpc3RyYXRpb24uc2NvcGUpO1xyXG4gICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgIC8vIHJlZ2lzdHJhdGlvbiBmYWlsZWQgOihcclxuICAgICAgY29uc29sZS5sb2coJ1NlcnZpY2VXb3JrZXIgcmVnaXN0cmF0aW9uIGZhaWxlZDogJywgZXJyKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59XHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBGVU5DVElPTlNcclxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBDUkVBVEUgSFlEUkFQUCBEQVRFIEtFWVxyXG5jb25zdCBzZXREYXRlS2V5ID0gKG9iaikgPT4ge1xyXG4gIGNvbnN0IHByZWZpeCA9ICdoeWRyQXBwLSc7XHJcbiAgY29uc3QgZGF0ZSA9IG9iai50b0lTT1N0cmluZygpLnNsaWNlKDAsMTApO1xyXG4gIHJldHVybiBwcmVmaXguY29uY2F0KGRhdGUpO1xyXG59XHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8gQ1JFQVRFIEtFWSBWQUxVRSBQQUlSIElOIExPQ0FMIFNUT1JBR0VcclxuY29uc3Qgc2V0TmV3S2V5VmFsdWUgPSAoa2V5LCB2YWx1ZSkgPT4ge1xyXG4gIGlmICggIWxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSkgKSB7XHJcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIHZhbHVlKTtcclxuICB9O1xyXG59XHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBDUkVBVEUgQVJSQVkgT0YgSFlEUkFQUCBMT0NBTCBTVE9SQUdFIEtFWVNcclxuY29uc3QgZ2V0SHlkcmFwcEtleXMgPSAoKSA9PiB7XHJcbiAgY29uc3QgcmVnZXggPSAvaHlkckFwcC0vO1xyXG4gIHJldHVybiBPYmplY3RcclxuICAua2V5cyhsb2NhbFN0b3JhZ2UpXHJcbiAgLmZpbHRlcihrZXkgPT4gcmVnZXgudGVzdChrZXkpKVxyXG4gIC5zb3J0KClcclxuICAucmV2ZXJzZSgpO1xyXG59XHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8gR0VUIERBVEUgSURcclxuY29uc3QgZ2V0RGF0ZUlEID0gKGRhdGUpID0+IHtcclxuICByZXR1cm4gZGF0ZVxyXG4gICAgLnJlcGxhY2UoJ2h5ZHJBcHAtJywnJylcclxuICAgIC5zcGxpdCgnLScpXHJcbiAgICAucmV2ZXJzZSgpXHJcbiAgICAuam9pbignJyk7XHJcbn1cclxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBHRVQgT0ZGU0VURUQgREFURVxyXG5jb25zdCBnZXRPZmZzZXRlZERhdGUgPSAoKSA9PiB7XHJcbiAgY29uc3QgdGltZVpvbmVPZmZzZXQgPSAobmV3IERhdGUoKSkuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwO1xyXG4gIHJldHVybiAobmV3IERhdGUoRGF0ZS5ub3coKSAtIHRpbWVab25lT2Zmc2V0KSk7XHJcbn1cclxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBTRVQgQ09VTlRFUlxyXG5jb25zdCBzZXRDb3VudGVyID0gKCkgPT4ge1xyXG4gIGNvbnN0IG9mZnNldGVkRGF0ZSA9IGdldE9mZnNldGVkRGF0ZSgpO1xyXG4gIGxldCBkYXRlS2V5ID0gc2V0RGF0ZUtleShvZmZzZXRlZERhdGUpO1xyXG4gIGNvbnNvbGUubG9nKGBuZXdlc3Qga2V5OiAke2RhdGVLZXl9YCk7XHJcblxyXG4gIHNldE5ld0tleVZhbHVlKGRhdGVLZXksIDApO1xyXG5cclxuICBjb25zdCBoeWRyYXBwS2V5cyA9IGdldEh5ZHJhcHBLZXlzKCk7XHJcbiAgY29uc3Qgb2xkZXN0S2V5ID0gaHlkcmFwcEtleXNbaHlkcmFwcEtleXMubGVuZ3RoLTFdO1xyXG4gIGNvbnNvbGUubG9nKGBvbGRlc3Qga2V5OiAke29sZGVzdEtleX1gKTtcclxuXHJcbiAgLy8gYXV0b2NvbXBsZXRlIG1pc3Npbmcga2V5cyBpbiBsb2NhbHN0b3JhZ2VcclxuICBpZiAoIGh5ZHJhcHBLZXlzLmxlbmd0aCA+IDEgKSB7XHJcbiAgICBsZXQgbGltaXQgPSAwOyAvLyBmb3IgdGVzdHMgdG8gYXZvaWQgbG9vcCBlcnJvclxyXG5cclxuICAgIHdoaWxlIChzZXREYXRlS2V5KG9mZnNldGVkRGF0ZSkgIT09IG9sZGVzdEtleSAmJiBsaW1pdCA8IDUwKSB7XHJcbiAgICAgIG9mZnNldGVkRGF0ZS5zZXREYXRlKCBvZmZzZXRlZERhdGUuZ2V0RGF0ZSgpIC0gMSApO1xyXG4gICAgICBjb25zdCBwcmV2RGF0ZUtleSA9IHNldERhdGVLZXkob2Zmc2V0ZWREYXRlKTtcclxuICAgICAgc2V0TmV3S2V5VmFsdWUocHJldkRhdGVLZXksIDApO1xyXG4gICAgICBsaW1pdCsrO1xyXG4gICAgfVxyXG4gIH1cclxuICBjb3VudGVyLmlubmVySFRNTCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGRhdGVLZXkpO1xyXG59XHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8gU0VUIEFSQ0hJVkVcclxuY29uc3Qgc2V0QXJjaGl2ZSA9ICgpID0+IHtcclxuICBjb25zdCBoeWRyYXBwS2V5cyA9IGdldEh5ZHJhcHBLZXlzKCk7XHJcblxyXG4gIGlmIChoeWRyYXBwS2V5cy5sZW5ndGggPT09IDEpIHtcclxuICAgIGFyY2hpdmVMaXN0LmlubmVySFRNTCArPSBgXHJcbiAgICAgIDxsaSBjbGFzcz1cImFyY2hpdmVfX2l0ZW0gYXJjaGl2ZV9faXRlbS0tZW1wdHlcIj5ObyBoaXN0b3J5IHlldC4uLjwvbGk+XHJcbiAgICAgIGA7XHJcbiAgfSBlbHNlIHtcclxuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgaHlkcmFwcEtleXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgY29uc3Qga2V5ID0gaHlkcmFwcEtleXNbaV07XHJcbiAgICAgIGNvbnN0IHZhbHVlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgY29uc3QgZGF0ZSA9IGtleVxyXG4gICAgICAgIC5yZXBsYWNlKCdoeWRyQXBwLScsJycpXHJcbiAgICAgICAgLnNwbGl0KCctJylcclxuICAgICAgICAucmV2ZXJzZSgpXHJcbiAgICAgICAgLmpvaW4oJyAnKTtcclxuICAgICAgY29uc3QgZGF0ZUlEID0gZGF0ZS5yZXBsYWNlKC9cXHMvZywnJyk7XHJcbiAgICAgIFxyXG4gICAgICBsZXQgaW5kaWNhdG9ycyA9IFwiXCI7XHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgODsgaSsrKSB7XHJcbiAgICAgICAgaW5kaWNhdG9ycyArPSBgXHJcbiAgICAgICAgPHN2ZyBjbGFzcz1cImluZGljYXRvcl9fc3ZnIGluZGljYXRvcl9fc3ZnLS1lbW8tJHtpKzF9IGluZGljYXRvcl9fc3ZnLS1qcy0ke2l9XCI+XHJcbiAgICAgICAgICA8dXNlIGhyZWY9XCJhc3NldHMvc3ZnL2ljb25zLnN2ZyNlbW90aWNvbi0ke2l9XCI+PC91c2U+XHJcbiAgICAgICAgPC9zdmc+YFxyXG4gICAgICB9XHJcblxyXG4gICAgICBhcmNoaXZlTGlzdC5pbm5lckhUTUwgKz0gYFxyXG4gICAgICA8bGkgY2xhc3M9XCJhcmNoaXZlX19pdGVtIGFyY2hpdmVfX2l0ZW0tLWpzICR7a2V5fVwiPlxyXG4gICAgICAgIDxwIGNsYXNzPVwiYXJjaGl2ZV9fZGF0ZVwiPiR7ZGF0ZX08L3A+XHJcbiAgICAgICAgPHAgY2xhc3M9XCJhcmNoaXZlX192YWx1ZSBhcmNoaXZlX192YWx1ZS0tanNcIj5cclxuICAgICAgICAgICR7dmFsdWV9XHJcbiAgICAgICAgPC9wPlxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJlZGl0aW9uIGVkaXRpb24tLWpzXCI+XHJcbiAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwiYnV0dG9uIGVkaXRpb25fX2J1dHRvbiBlZGl0aW9uX19idXR0b24tLXZpc2libGUgZWRpdGlvbl9fYnV0dG9uLS1lZGl0IGVkaXRpb25fX2J1dHRvbi0tanMtZWRpdFwiPlxyXG4gICAgICAgICAgICA8c3ZnIGNsYXNzPVwiZWRpdGlvbl9fc3ZnIGVkaXRpb25fX3N2Zy0tZWRpdFwiPlxyXG4gICAgICAgICAgICAgIDx1c2UgaHJlZj1cImFzc2V0cy9zdmcvaWNvbnMuc3ZnI2VkaXQtbW9kZVwiPjwvdXNlPlxyXG4gICAgICAgICAgICA8L3N2Zz5cclxuICAgICAgICAgIDwvYnV0dG9uPlxyXG4gICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImJ1dHRvbiBlZGl0aW9uX19idXR0b24gZWRpdGlvbl9fYnV0dG9uLS1kZWNyZWFzZSBlZGl0aW9uX19idXR0b24tLWpzLWRlY3JlYXNlXCI+XHJcbiAgICAgICAgICAgIDxzdmcgY2xhc3M9XCJlZGl0aW9uX19zdmcgZWRpdGlvbl9fc3ZnLS1kZWNyZWFzZVwiPlxyXG4gICAgICAgICAgICAgIDx1c2UgaHJlZj1cImFzc2V0cy9zdmcvaWNvbnMuc3ZnI2xlZnQtYXJyb3dcIj48L3VzZT5cclxuICAgICAgICAgICAgPC9zdmc+XHJcbiAgICAgICAgICA8L2J1dHRvbj5cclxuICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJidXR0b24gZWRpdGlvbl9fYnV0dG9uIGVkaXRpb25fX2J1dHRvbi0taW5jcmVhc2UgZWRpdGlvbl9fYnV0dG9uLS1qcy1pbmNyZWFzZVwiPlxyXG4gICAgICAgICAgICA8c3ZnIGNsYXNzPVwiZWRpdGlvbl9fc3ZnIGVkaXRpb25fX3N2Zy0taW5jcmVhc2VcIj5cclxuICAgICAgICAgICAgICA8dXNlIGhyZWY9XCJhc3NldHMvc3ZnL2ljb25zLnN2ZyNyaWdodC1hcnJvd1wiPjwvdXNlPlxyXG4gICAgICAgICAgICA8L3N2Zz5cclxuICAgICAgICAgIDwvYnV0dG9uPlxyXG4gICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImJ1dHRvbiBlZGl0aW9uX19idXR0b24gZWRpdGlvbl9fYnV0dG9uLS1jYW5jZWwgZWRpdGlvbl9fYnV0dG9uLS1qcy1jYW5jZWxcIj5cclxuICAgICAgICAgICAgPHN2ZyBjbGFzcz1cImVkaXRpb25fX3N2ZyBlZGl0aW9uX19zdmctLWNhbmNlbFwiPlxyXG4gICAgICAgICAgICAgIDx1c2UgaHJlZj1cImFzc2V0cy9zdmcvaWNvbnMuc3ZnI2JhY2stYXJyb3dcIj48L3VzZT5cclxuICAgICAgICAgICAgPC9zdmc+XHJcbiAgICAgICAgICA8L2J1dHRvbj5cclxuICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJidXR0b24gZWRpdGlvbl9fYnV0dG9uIGVkaXRpb25fX2J1dHRvbi0tc2F2ZSBlZGl0aW9uX19idXR0b24tLWpzLXNhdmVcIj5cclxuICAgICAgICAgICAgPHN2ZyBjbGFzcz1cImVkaXRpb25fX3N2ZyBlZGl0aW9uX19zdmctLXNhdmVcIj5cclxuICAgICAgICAgICAgICA8dXNlIGhyZWY9XCJhc3NldHMvc3ZnL2ljb25zLnN2ZyNzYXZlLWljb25cIj48L3VzZT5cclxuICAgICAgICAgICAgPC9zdmc+XHJcbiAgICAgICAgICA8L2J1dHRvbj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwiaW5kaWNhdG9yIGluZGljYXRvci0tanMtJHtkYXRlSUR9XCI+XHJcbiAgICAgICAgICAke2luZGljYXRvcnN9XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgIDwvbGk+YFxyXG4gICAgICBzZXRJbmRpY2F0b3JzKGRhdGVJRCwgdmFsdWUpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vIFNFVCBJTkRJQ0FUT1JTXHJcbmNvbnN0IHNldEluZGljYXRvcnMgPSAoaWQsIHZhbHVlKSA9PiB7XHJcblxyXG4gIHZhbHVlID4gNyA/IHZhbHVlID0gNyA6IGZhbHNlO1xyXG5cclxuICBjb25zdCBpbmRpY2F0b3JzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLmluZGljYXRvci0tanMtJHtpZH1gKS5jaGlsZHJlbjtcclxuICBjb25zdCBpbmRpY2F0b3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuaW5kaWNhdG9yLS1qcy0ke2lkfSAuaW5kaWNhdG9yX19zdmctLWpzLSR7dmFsdWV9YCk7XHJcbiAgXHJcbiAgZm9yIChjb25zdCBpbmRpY2F0b3Igb2YgaW5kaWNhdG9ycykge1xyXG4gICAgaW5kaWNhdG9yLmNsYXNzTGlzdC5jb250YWlucygnaW5kaWNhdG9yX19zdmctLXZpc2libGUnKVxyXG4gICAgPyBpbmRpY2F0b3IuY2xhc3NMaXN0LnJlbW92ZSgnaW5kaWNhdG9yX19zdmctLXZpc2libGUnKVxyXG4gICAgOiBmYWxzZVxyXG4gIH1cclxuICBpbmRpY2F0b3IuY2xhc3NMaXN0LmFkZCgnaW5kaWNhdG9yX19zdmctLXZpc2libGUnKTtcclxufVxyXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vIFVQREFURSBDT1VOVEVSXHJcbmNvbnN0IHVwZGF0ZUNvdW50ZXIgPSAoZSkgPT4ge1xyXG4gIGNvbnN0IG9mZnNldGVkRGF0ZSA9IGdldE9mZnNldGVkRGF0ZSgpO1xyXG4gIGNvbnN0IGtleSA9IHNldERhdGVLZXkob2Zmc2V0ZWREYXRlKTtcclxuICBjb25zdCB2YWx1ZSA9IHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSkpO1xyXG4gIGxldCBuZXdWYWx1ZTtcclxuXHJcbiAgaWYgKGUudGFyZ2V0ID09PSBhZGRHbGFzcykge1xyXG4gICAgdmFsdWUgPCBjb3VudGVyTWF4VmFsdWUgPyBuZXdWYWx1ZSA9IHZhbHVlICsgMSA6IG5ld1ZhbHVlID0gY291bnRlck1heFZhbHVlO1xyXG4gIH0gZWxzZSBpZiAoZS50YXJnZXQgPT09IHJlbW92ZUdsYXNzKSB7XHJcbiAgICB2YWx1ZSA+IDAgPyBuZXdWYWx1ZSA9IHZhbHVlIC0gMSA6IG5ld1ZhbHVlID0gMDtcclxuICB9XHJcblxyXG4gIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgbmV3VmFsdWUpO1xyXG4gIGNvdW50ZXIuaW5uZXJIVE1MID0gbmV3VmFsdWU7XHJcbiAgXHJcbiAgLy8gdXBkYXRpbmcgYXJjaGl2ZSBuZXdlc3QgZW50cnkgaW5kaWNhdG9yXHJcbiAgY29uc3QgZGF0ZUlEID0gb2Zmc2V0ZWREYXRlXHJcbiAgICAudG9JU09TdHJpbmcoKVxyXG4gICAgLnNsaWNlKDAsMTApXHJcbiAgICAuc3BsaXQoJy0nKVxyXG4gICAgLnJldmVyc2UoKVxyXG4gICAgLmpvaW4oJycpO1xyXG59XHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8gVE9HR0xFIEFSQ0hJVkVcclxuY29uc3QgdG9nZ2xlQXJjaGl2ZSA9ICgpID0+IHtcclxuICBhcmNoaXZlLmNsYXNzTGlzdC50b2dnbGUoJ2FyY2hpdmUtLXZpc2libGUnKTtcclxuXHJcbiAgbG9hZE1vcmVCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSgnYXJjaGl2ZV9fYnV0dG9uLS1oaWRkZW4nKTtcclxuICBmb3IgKGNvbnN0IGFyY2hpdmVJdGVtIG9mIGFyY2hpdmVJdGVtcykge1xyXG4gICAgYXJjaGl2ZUl0ZW0uY2xhc3NMaXN0LnJlbW92ZSgnYXJjaGl2ZV9faXRlbS0tdmlzaWJsZScpO1xyXG4gIH1cclxuXHJcbiAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBMT0FEIE1PUkUgPDwgVE9HR0xFIEFSQ0hJVkVcclxuICBjb25zdCBsb2FkTW9yZSA9ICgpID0+IHtcclxuICAgIFxyXG4gICAgLy8gY29uc3QgYWxsRXF1YWwgPSBpdGVtc0hlaWdodHMuZXZlcnkoIGVsZW0gPT4gZWxlbSA9PT0gaXRlbXNIZWlnaHRzWzBdKTtcclxuICAgIC8vIGNvbnN0IGl0ZW1zSGVpZ2h0cyA9IGl0ZW1zQXJyYXkubWFwKGVsZW0gPT4gZWxlbS5vZmZzZXRIZWlnaHQpO1xyXG4gICAgXHJcbiAgICBjb25zdCBpdGVtQXJyYXkgPSBbLi4uYXJjaGl2ZUl0ZW1zXTtcclxuICAgIGNvbnN0IGFyY2hpdmVMaXN0SGVpZ2h0ID0gYXJjaGl2ZUxpc3QuY2xpZW50SGVpZ2h0O1xyXG5cclxuICAgIGxldCBmaXJzdEluZGV4VG9Mb2FkID0gaXRlbUFycmF5LmZpbmRJbmRleChlbGVtID0+ICFlbGVtLmNsYXNzTGlzdC5jb250YWlucygnYXJjaGl2ZV9faXRlbS0tdmlzaWJsZScpKTtcclxuICAgIGxldCBoZWlnaHRzID0gMDtcclxuICAgIGxldCBzY3JvbGxPZmZzZXQgPSBhcmNoaXZlTGlzdC5zY3JvbGxUb3A7XHJcbiAgICB3aGlsZSAodHJ1ZSkge1xyXG4gICAgICBcclxuICAgICAgaWYgKGZpcnN0SW5kZXhUb0xvYWQgPCBpdGVtQXJyYXkubGVuZ3RoKSB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgaXRlbSA9IGl0ZW1BcnJheVtmaXJzdEluZGV4VG9Mb2FkXTtcclxuICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoJ2FyY2hpdmVfX2l0ZW0tLXZpc2libGUnKTtcclxuICAgICAgICBoZWlnaHRzICs9IGl0ZW0ub2Zmc2V0SGVpZ2h0O1xyXG4gICAgICAgIHNjcm9sbE9mZnNldCArPSBpdGVtLm9mZnNldEhlaWdodDtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoaGVpZ2h0cyA8PSBhcmNoaXZlTGlzdEhlaWdodCAtIGl0ZW0ub2Zmc2V0SGVpZ2h0KSB7XHJcbiAgICAgICAgICBmaXJzdEluZGV4VG9Mb2FkKys7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGFyY2hpdmVMaXN0LnNjcm9sbFRvcCA9IHNjcm9sbE9mZnNldDtcclxuICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGFyY2hpdmVMaXN0LnNjcm9sbFRvcCA9IHNjcm9sbE9mZnNldDtcclxuICAgICAgICBsb2FkTW9yZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdhcmNoaXZlX19idXR0b24tLWhpZGRlbicpO1xyXG4gICAgICAgIGxvYWRNb3JlQnV0dG9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgbG9hZE1vcmUpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBGVU5DVElPTiBDQUxMUyA8PCBUT0dHTEUgQVJDSElWRVxyXG4gIGlmIChhcmNoaXZlLmNsYXNzTGlzdC5jb250YWlucygnYXJjaGl2ZS0tdmlzaWJsZScpKSB7XHJcbiAgICBsb2FkTW9yZSgpO1xyXG4gICAgbG9hZE1vcmVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBsb2FkTW9yZSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGxvYWRNb3JlQnV0dG9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgbG9hZE1vcmUpO1xyXG4gIH1cclxuICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vIEVWRU5UIExJU1RFTkVSUyA8PCBUT0dHTEUgQVJDSElWRVxyXG59XHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBFTkQgT0YgVE9HR0xFIEFSQ0hJVkVcclxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBIQU5ETEUgSVRFTSBFRElUXHJcbmNvbnN0IGhhbmRsZUl0ZW1FZGl0ID0gKGUpID0+IHtcclxuICBjb25zdCBpdGVtSW5kZXggPSBlLnRhcmdldC5pbmRleDtcclxuICBjb25zdCBhcmNoaXZlSXRlbSA9IGFyY2hpdmVJdGVtc1tpdGVtSW5kZXhdO1xyXG4gIGNvbnN0IGVkaXRCdXR0b24gPSBlZGl0QnV0dG9uc1tpdGVtSW5kZXhdO1xyXG4gIGNvbnN0IGVkaXRTZWN0aW9uID0gZWRpdFNlY3Rpb25zW2l0ZW1JbmRleF07XHJcbiAgY29uc3QgZGVjcmVhc2VCdXR0b24gPSBkZWNyZWFzZUJ1dHRvbnNbaXRlbUluZGV4XTtcclxuICBjb25zdCBpbmNyZWFzZUJ1dHRvbiA9IGluY3JlYXNlQnV0dG9uc1tpdGVtSW5kZXhdO1xyXG4gIGNvbnN0IGNhbmNlbEJ1dHRvbiA9IGNhbmNlbEJ1dHRvbnNbaXRlbUluZGV4XTtcclxuICBjb25zdCBzYXZlQnV0dG9uID0gc2F2ZUJ1dHRvbnNbaXRlbUluZGV4XTtcclxuICBjb25zdCBhcmNoaXZlVmFsdWUgPSBhcmNoaXZlVmFsdWVzW2l0ZW1JbmRleF07XHJcbiAgY29uc3QgbGFzdFZhbHVlID0gYXJjaGl2ZVZhbHVlLnRleHRDb250ZW50O1xyXG4gIGNvbnN0IGl0ZW1DbGFzc05hbWUgPSBlLnRhcmdldC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NOYW1lO1xyXG5cclxuICBjb25zdCBoeWRyQXBwS2V5ID0gaXRlbUNsYXNzTmFtZVxyXG4gICAgLnNwbGl0KCcgJylcclxuICAgIC5maWx0ZXIoa2V5ID0+IC9oeWRyQXBwLy50ZXN0KGtleSkpXHJcbiAgICAudG9TdHJpbmcoKTtcclxuICBjb25zdCBkYXRlSUQgPSBnZXREYXRlSUQoaHlkckFwcEtleSk7XHJcbiAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBUT0dHTEUgSVRFTSBESVNQTEFZIDw8IEhBTkRMRSBJVEVNIEVESVRcclxuICBjb25zdCB0b2dnbGVJdGVtRGlzcGxheSA9ICgpID0+IHtcclxuICAgIGFyY2hpdmUuY2xhc3NMaXN0LnRvZ2dsZSgnYXJjaGl2ZS0tb24tdG9wJyk7XHJcbiAgICBhcmNoaXZlSXRlbS5jbGFzc0xpc3QudG9nZ2xlKCdhcmNoaXZlX19pdGVtLS1vbi10b3AnKTtcclxuICAgIHBhZ2VPdmVybGF5LmNsYXNzTGlzdC50b2dnbGUoJ2FyY2hpdmVfX292ZXJsYXktLXZpc2libGUnKTtcclxuICAgIFxyXG4gICAgZm9yIChjb25zdCBlZGl0QnV0dG9uIG9mIGVkaXRTZWN0aW9uLmNoaWxkcmVuKSB7XHJcbiAgICAgIGVkaXRCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZSgnZWRpdGlvbl9fYnV0dG9uLS12aXNpYmxlJyk7XHJcbiAgICB9XHJcbiAgICBlZGl0U2VjdGlvbi5jbGFzc0xpc3QudG9nZ2xlKCdlZGl0aW9uLS12aXNpYmxlJyk7XHJcbiAgfVxyXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBFWElUIEVESVQgTU9ERSA8PCBIQU5ETEUgSVRFTSBFRElUXHJcbiAgY29uc3QgZXhpdEVkaXRNb2RlID0gKCkgPT4ge1xyXG4gICAgdG9nZ2xlSXRlbURpc3BsYXkoKTtcclxuICAgIGNvbnN0IGxhc3RWYWx1ZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGh5ZHJBcHBLZXkpO1xyXG4gICAgYXJjaGl2ZVZhbHVlLnRleHRDb250ZW50ID0gbGFzdFZhbHVlO1xyXG4gICAgc2V0SW5kaWNhdG9ycyhkYXRlSUQsIGxhc3RWYWx1ZSk7XHJcblxyXG4gICAgYXJjaGl2ZS5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUVkaXRpb24pO1xyXG4gICAgYXJjaGl2ZS5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgaGFuZGxlRWRpdGlvbik7XHJcbiAgfVxyXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBIQU5ETEUgRURJVElPTiA8PCBIQU5ETEUgSVRFTSBFRElUXHJcbiAgY29uc3QgaGFuZGxlRWRpdGlvbiA9IChlKSA9PiB7XHJcbiAgICBjb25zdCBzZWxmID0gZS5rZXlDb2RlIHx8IGUudGFyZ2V0O1xyXG4gICAgbGV0IHZhbHVlID0gcGFyc2VJbnQoYXJjaGl2ZVZhbHVlLnRleHRDb250ZW50KTtcclxuXHJcbiAgICBzd2l0Y2ggKHNlbGYpIHtcclxuXHJcbiAgICAgIGNhc2UgMzc6XHJcbiAgICAgIGNhc2UgZGVjcmVhc2VCdXR0b246XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIHZhbHVlID4gMCA/IHZhbHVlLS0gOiBmYWxzZTtcclxuICAgICAgICBhcmNoaXZlVmFsdWUudGV4dENvbnRlbnQgPSB2YWx1ZTtcclxuICAgICAgICBzZXRJbmRpY2F0b3JzKGRhdGVJRCwgdmFsdWUpO1xyXG4gICAgICBicmVhaztcclxuICAgICAgXHJcbiAgICAgIGNhc2UgMzk6XHJcbiAgICAgIGNhc2UgaW5jcmVhc2VCdXR0b246XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIHZhbHVlIDwgY291bnRlck1heFZhbHVlID8gdmFsdWUrKyA6IGZhbHNlO1xyXG4gICAgICAgIGFyY2hpdmVWYWx1ZS50ZXh0Q29udGVudCA9IHZhbHVlO1xyXG4gICAgICAgIHNldEluZGljYXRvcnMoZGF0ZUlELCB2YWx1ZSk7XHJcbiAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgY2FzZSAyNzpcclxuICAgICAgY2FzZSBwYWdlT3ZlcmxheTpcclxuICAgICAgY2FzZSBjYW5jZWxCdXR0b246XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIGV4aXRFZGl0TW9kZSgpO1xyXG4gICAgICBicmVhaztcclxuXHJcbiAgICAgIGNhc2UgMTM6XHJcbiAgICAgIGNhc2Ugc2F2ZUJ1dHRvbjpcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oaHlkckFwcEtleSwgcGFyc2VJbnQoYXJjaGl2ZVZhbHVlLnRleHRDb250ZW50KSk7XHJcbiAgICAgICAgZXhpdEVkaXRNb2RlKCk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gIH1cclxuICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8gRlVOQ1RJT04gQ0FMTFMgPDwgSEFORExFIElURU0gRURJVFxyXG4gIHRvZ2dsZUl0ZW1EaXNwbGF5KCk7XHJcbiAgYXJjaGl2ZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUVkaXRpb24pO1xyXG4gIGFyY2hpdmUuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGhhbmRsZUVkaXRpb24pO1xyXG59IC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vIEVORCBPRiBIQU5ETEUgSVRFTSBFRElUXHJcblxyXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBWQVJJQUJMRVNcclxuY29uc3QgYWRkR2xhc3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYXBwX19idXR0b24tLWpzLWFkZCcpO1xyXG5jb25zdCByZW1vdmVHbGFzcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hcHBfX2J1dHRvbi0tanMtcmVtb3ZlJyk7XHJcbmNvbnN0IGNvdW50ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ2xhc3NfX2NvdW50ZXItLWpzJyk7XHJcbmNvbnN0IGFyY2hpdmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYXJjaGl2ZS0tanMnKTtcclxuY29uc3QgcGFnZU92ZXJsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYXJjaGl2ZV9fb3ZlcmxheS0tanMnKTtcclxuY29uc3QgYXJjaGl2ZUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYXJjaGl2ZV9fbGlzdC0tanMnKTtcclxuY29uc3QgYXJjaGl2ZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uYXZpZ2F0aW9uX19idXR0b24tLWpzLWFyY2hpdmUnKTtcclxuY29uc3QgbG9hZE1vcmVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYXJjaGl2ZV9fYnV0dG9uLS1qcy1sb2FkLW1vcmUnKTtcclxuXHJcbmNvbnN0IGNvdW50ZXJNYXhWYWx1ZSA9IDEwMDtcclxuXHJcbmNvbnN0IGJhc2VDbGFzc25hbWUgPSBcImluZGljYXRvcl9fc2VjdGlvbiBpbmRpY2F0b3JfX3NlY3Rpb24tLWpzXCI7XHJcbmNvbnN0IGxvd0xldmVsQ2xhc3NuYW1lID0gYCR7YmFzZUNsYXNzbmFtZX0gaW5kaWNhdG9yX19zZWN0aW9uLS1sb3dgO1xyXG5jb25zdCBtZWRpdW1MZXZlbENsYXNzbmFtZSA9IGAke2Jhc2VDbGFzc25hbWV9IGluZGljYXRvcl9fc2VjdGlvbi0tbWVkaXVtYDtcclxuY29uc3QgaGlnaExldmVsQ2xhc3NuYW1lID0gYCR7YmFzZUNsYXNzbmFtZX0gaW5kaWNhdG9yX19zZWN0aW9uLS1oaWdoYDtcclxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8gSU5JVElBTCBGVU5DVElPTiBDQUxMU1xyXG5zZXRDb3VudGVyKCk7XHJcbnNldEFyY2hpdmUoKTtcclxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vIFZBUklBQkxFU1xyXG5jb25zdCBhcmNoaXZlSXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYXJjaGl2ZV9faXRlbS0tanMnKTtcclxuY29uc3QgZWRpdEJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZWRpdGlvbl9fYnV0dG9uLS1qcy1lZGl0Jyk7XHJcbmNvbnN0IGVkaXRTZWN0aW9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5lZGl0aW9uLS1qcycpO1xyXG5jb25zdCBkZWNyZWFzZUJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZWRpdGlvbl9fYnV0dG9uLS1qcy1kZWNyZWFzZScpO1xyXG5jb25zdCBpbmNyZWFzZUJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZWRpdGlvbl9fYnV0dG9uLS1qcy1pbmNyZWFzZScpO1xyXG5jb25zdCBjYW5jZWxCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmVkaXRpb25fX2J1dHRvbi0tanMtY2FuY2VsJyk7XHJcbmNvbnN0IHNhdmVCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmVkaXRpb25fX2J1dHRvbi0tanMtc2F2ZScpO1xyXG5jb25zdCBhcmNoaXZlVmFsdWVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmFyY2hpdmVfX3ZhbHVlLS1qcycpO1xyXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vIEZVTkNUSU9OIENBTExTXHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBFVkVOVCBMSVNURU5FUlNcclxuYWRkR2xhc3MuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB1cGRhdGVDb3VudGVyKTtcclxucmVtb3ZlR2xhc3MuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB1cGRhdGVDb3VudGVyKTtcclxuYXJjaGl2ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRvZ2dsZUFyY2hpdmUpO1xyXG5cclxuZm9yIChsZXQgaSA9IDA7IGkgPCBlZGl0QnV0dG9ucy5sZW5ndGg7IGkrKykge1xyXG4gIGNvbnN0IGVkaXRCdXR0b24gPSBlZGl0QnV0dG9uc1tpXTtcclxuICBlZGl0QnV0dG9uLmluZGV4ID0gaTtcclxuICBlZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlSXRlbUVkaXQpO1xyXG59Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///0\n")}]);